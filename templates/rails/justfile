# Justfile for Rails + Nix + Bundix workflow (fish version)

set shell := ["fish", "-c"]

# --- Dependency Management ---
update-gems:
    bundle-lock
    bundix

update-nodes:
    node2nix -i package.json -o node-packages.nix -c composition.nix

add-gem +gems:
    bundle add {{gems}} --skip-install
    just update-deps

add-node +nodes:
    npm install {{nodes}} --save-dev
    update-nodes

remove-gem +gems:
    bundle remove {{gems}}
    just update-deps

# --- Rails Commands ---
migrate:
    bin/rails db:migrate

rollback:
    bin/rails db:rollback

seed:
    bin/rails db:seed

console:
    bin/rails console

server:
    foreman start

test:
    bin/rails test

# --- Utilities ---
routes:
    bin/rails routes

log:
    tail -f log/development.log

# --- Nix Tools ---
shell:
    nix develop

lock:
    nix flake lock --update-input nixpkgs

# --- Git Helpers ---
commit msg="chore: update":
    git add .
    git commit -m "{{msg}}"
